# automation for managing firefox profiles with extensions
# commands:
# * firefox-profile-list
# * firefox-profile-create new-name-of-profile
# * firefox-profile-start new-name-of-profile
#
FIREFOX_HOME=$HOME/.mozilla/firefox

function firefox-profile-list(){
    echo "-----"
    if [[ -e $FIREFOX_PROFILES_DIR ]]; then
        ls $FIREFOX_PROFILES_DIR | grep "profile-"
    else
        echo "set env variable: FIREFOX_PROFILES_DIR" 
    fi
    echo "-----"
}

function firefox-profile-start(){
    if [[ $1 == "" ]]; then
        echo "specify profile"
        return;
    fi
    if [[ -z $FIREFOX_PROFILES_DIR ]]; then
        echo "no variable set: FIREFOX_PROFILES_DIR"
        return
    fi
    PROFILE_DIR=$FIREFOX_PROFILES_DIR/"profile-"$1
    if [[ -e $PROFILE_DIR ]]; then
        firefox --profile $PROFILE_DIR --no-first-run --no-default-browser-check &
    else
        echo "profile $PROFILE_DIR does not exist"
    fi
}

function firefox-profile-create(){
    if [[ $1 == "" ]]; then
        echo "specify profile name"
        return;
    fi
    if [[ -z $FIREFOX_PROFILES_DIR ]]; then
        echo "no variable set: FIREFOX_PROFILES_DIR"
        return
    fi
    PROFILE_NEW_NAME="profile-"$1
    PROFILE_DIR=$FIREFOX_PROFILES_DIR"/"$PROFILE_NEW_NAME
    if [[ -e $PROFILE_DIR ]]; then
        echo "profile $PROFILE_DIR exist !!! "
        return;
    fi

    # print info
    echo ">>>"$PROFILE_NEW_NAME
    echo $PROFILE_DIR

    # extensions creation
    PROFILE_EXTENSION_DIR=$PROFILE_DIR/extensions
    mkdir -p $PROFILE_EXTENSION_DIR
    if [[ -e $FIREFOX_EXTENSIONS && -e $FIREFOX_EXTENSION_ORIGINAL_DIR ]]; then
        for each_extension in "${FIREFOX_EXTENSIONS[@]}"; do
            echo "copy extensions: $FIREFOX_EXTENSION_ORIGINAL_DIR/$each_extension --> $PROFILE_EXTENSION_DIR/$each_extension"
            cp $FIREFOX_EXTENSION_ORIGINAL_DIR/$each_extension $PROFILE_EXTENSION_DIR/$each_extension
        done;
    fi

    # open firefox 
    firefox --profile $PROFILE_DIR --no-default-browser-check &
}



function firefox-profile-create-temp(){
    TEMP_PROFILE_FOLDER=`mktemp -d`
    firefox --profile $TEMP_PROFILE_FOLDER --no-default-browser-check &
}