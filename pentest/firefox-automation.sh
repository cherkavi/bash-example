# automation for managing firefox profiles with extensions
# commands:
# * firefox-profile-list
# * firefox-profile-create new-name-of-profile
# * firefox-profile-start new-name-of-profile
#
FIREFOX_HOME=$HOME/.mozilla/firefox
FIREFOX_PROFILES_DIR=$HOME/Documents/firefox-profiles
FIREFOX_EXTENSION_ORIGINAL_DIR=$HOME/soft/firefox_extensions
FIREFOX_EXTENSIONS=("{35dd5f9a-ca89-4643-b107-f07d09cc94b5}.xpi" "{d7742d87-e61d-4b78-b8a1-b469842139fa}.xpi" "foxyproxy@eric.h.jung.xpi" "addon@darkreader.org.xpi" "{e855175b-f84a-429d-85d6-a61831c8291c}.xpi" "{11a68c03-baa3-41fb-869c-5172c4c4dd2e}.xpi" )

function firefox-profile-list(){
    echo "-----"
    ls $FIREFOX_PROFILES_DIR | grep "profile-"
    echo "-----"
}

function firefox-profile-start(){
    if [[ $1 == "" ]]; then
        echo "specify profile"
        return;
    fi
    PROFILE_DIR=$FIREFOX_PROFILES_DIR/"profile-"$1
    if [[ -e $PROFILE_DIR ]]; then
        firefox --profile $PROFILE_DIR --no-first-run --no-default-browser-check &
    else
        echo "profile $PROFILE_DIR does not exist"
    fi
}

function firefox-profile-create(){
    if [[ $1 == "" ]]; then
        echo "specify profile name"
        return;
    fi
    PROFILE_NEW_NAME="profile-"$1
    PROFILE_DIR=$FIREFOX_PROFILES_DIR"/"$PROFILE_NEW_NAME
    if [[ -e $PROFILE_DIR ]]; then
        echo "profile $PROFILE_DIR exist !!! "
        return;
    fi

    # extensions creation
    PROFILE_EXTENSION_DIR=$PROFILE_DIR/extensions/
    mkdir -p $PROFILE_EXTENSION_DIR
    for each_extension in "${FIREFOX_EXTENSIONS[@]}"; do
        cp $FIREFOX_EXTENSION_ORIGINAL_DIR/$each_extension $PROFILE_EXTENSION_DIR/$each_extension
    done;

    # print info
    echo ">>>"$PROFILE_NEW_NAME
    echo $PROFILE_DIR
    firefox --profile $PROFILE_DIR --no-first-run --no-default-browser-check
}

